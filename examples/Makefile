#
# Examples Makefile.
#
#                  M. Kirsanov 07.04.2006
#                     Modified 18.11.2006

SHELL = /bin/sh

-include ../config.mk
-include config.mk

# Location of directories.
TMPDIR=tmp
TOPDIR=$(shell \pwd)
INCDIR=include
SRCDIR=src
LIBDIR=lib
LIBDIRARCH=lib/archive
BINDIR=bin

# There is no default behaviour, so remind user.
all:
	@echo "Usage: for NN = example number: make mainNN"

# Create an executable for one of the normal test programs
main01 main02 main03 main04 main05 main06 main07 main08 main09 main10 \
	main14 main15 main16 main17 main18 main41: \
	../$(LIBDIRARCH)/libpythia8.a
	@mkdir -p ../$(BINDIR)
	$(CXX) $(CXXFLAGS) -I../$(INCDIR) $@.cc -o ../$(BINDIR)/$@.exe \
	-L../$(LIBDIRARCH) -lpythia8 -llhapdfdummy
	@ln -fs ../$(BINDIR)/$@.exe $@.exe

# Create an executable that links to Pythia6 
main11 main12: \
	../$(LIBDIRARCH)/libpythia8.a
	@mkdir -p ../$(BINDIR)
	$(CXX) $(CXXFLAGS) -I../$(INCDIR) $@.cc -o ../$(BINDIR)/$@.exe \
	-L../$(LIBDIRARCH) -lpythia8 -llhapdfdummy \
	-L$(PYTHIA6LOCATION) $(PYTHIA6LIBNAME) \
	$(FLIBS)
	@ln -fs ../$(BINDIR)/$@.exe $@.exe

# Create an executable for the Fortran test program, as prelude to main14 
main13: ../$(LIBDIRARCH)/libpythia8.a
	@mkdir -p ../$(BINDIR)
	$(FC) $(FFLAGS) $@.f -o ../$(BINDIR)/$@.exe \
	-L$(PYTHIA6LOCATION) $(PYTHIA6LIBNAME) $(FLIBS)
	@ln -fs ../$(BINDIR)/$@.exe $@.exe

# Create an executable linked to HepMC and CLHEP (if all goes well).
ifneq (x$(HEPMCLOCATION),x)
 ifeq ($(findstring x2,x$(HEPMCVERSION)),x2)
   # without pythia6:
   main21 main23: ../$(LIBDIRARCH)/libpythia8.a ../$(LIBDIRARCH)/libhepmcinterface.a
	 @mkdir -p ../$(BINDIR)
	 $(CXX) $(CXXFLAGS) -I../$(INCDIR) -I$(HEPMCLOCATION)/include \
	 $@.cc -o ../$(BINDIR)/$@.exe \
	 -L../$(LIBDIRARCH) -lpythia8 -llhapdfdummy \
	 -lhepmcinterface \
	 -L$(HEPMCLOCATION)/lib -lHepMC
	 @ln -fs ../$(BINDIR)/$@.exe $@.exe
   # with pythia6:
   main22: ../$(LIBDIRARCH)/libpythia8.a ../$(LIBDIRARCH)/libhepmcinterface.a
	 @mkdir -p ../$(BINDIR)
	 $(CXX) $(CXXFLAGS) -I../$(INCDIR) -I$(HEPMCLOCATION)/include \
	 $@.cc -o ../$(BINDIR)/$@.exe \
	 -L../$(LIBDIRARCH) -lpythia8 -llhapdfdummy \
	 -L$(PYTHIA6LOCATION) $(PYTHIA6LIBNAME) \
	 -lhepmcinterface \
	 -L$(HEPMCLOCATION)/lib -lHepMC \
	 $(FLIBS)
	 @ln -fs ../$(BINDIR)/$@.exe $@.exe
 else
  ifneq (x$(CLHEPLOCATION),x)
   # without pythia6:
   main21 main23: ../$(LIBDIRARCH)/libpythia8.a ../$(LIBDIRARCH)/libhepmcinterface.a
	 @mkdir -p ../$(BINDIR)
	 $(CXX) $(CXXFLAGS) -I../$(INCDIR) -I$(HEPMCLOCATION)/include \
	 -I$(CLHEPLOCATION)/include $@.cc -o ../$(BINDIR)/$@.exe \
	 -L../$(LIBDIRARCH) -lpythia8 -llhapdfdummy \
	 -lhepmcinterface \
	 -L$(HEPMCLOCATION)/lib -lHepMC \
	 -L$(CLHEPLOCATION)/lib -lCLHEP
	 @ln -fs ../$(BINDIR)/$@.exe $@.exe
   # with pythia6:
   main22: ../$(LIBDIRARCH)/libpythia8.a ../$(LIBDIRARCH)/libhepmcinterface.a
	 @mkdir -p ../$(BINDIR)
	 $(CXX) $(CXXFLAGS) -I../$(INCDIR) -I$(HEPMCLOCATION)/include \
	 -I$(CLHEPLOCATION)/include $@.cc -o ../$(BINDIR)/$@.exe \
	 -L../$(LIBDIRARCH) -lpythia8 -llhapdfdummy \
	 -L$(PYTHIA6LOCATION) $(PYTHIA6LIBNAME) \
	 -lhepmcinterface \
	 -L$(HEPMCLOCATION)/lib -lHepMC \
	 -L$(CLHEPLOCATION)/lib -lCLHEP \
	 $(FLIBS)
	 @ln -fs ../$(BINDIR)/$@.exe $@.exe
  else
   main21 main22 main23:
	@echo ERROR, apart from HepMC this target needs CLHEP, \
	variable CLHEPLOCATION
  endif
 endif
else
 main21 main22 main23:
	@echo ERROR, this target needs HepMC, variable HEPMCLOCATION
endif

# Create an executable that links to LHAPDF
main31 main32: \
    ../$(LIBDIRARCH)/libpythia8.a
	@mkdir -p ../$(BINDIR)
	$(CXX) $(CXXFLAGS) -I../$(INCDIR) $@.cc -o ../$(BINDIR)/$@.exe \
	-L../$(LIBDIRARCH) -lpythia8 \
	-L$(LHAPDFLOCATION) $(LHAPDFLIBNAME) \
	$(FLIBS)
	@ln -fs ../$(BINDIR)/$@.exe $@.exe

# Clean up: remove executables and outdated files.
.PHONY: clean
clean:
	rm -rf ../$(BINDIR)
	rm -rf *.exe
	rm -f *~; rm -f \#*; rm -f core*
