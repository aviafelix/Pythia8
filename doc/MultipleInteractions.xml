<chapter name="Multiple Interactions">

<h1>Multiple Interactions</h1>

The starting point for the multiple interactions physics scenario in
Pythia is provided by [1]. Recent developments have included a more
careful study of flavour and colour correlations, junction topologies
and the relationship to beam remnants [2], and interleaving with 
initial-state radiation [3], making use of transverse-momentum-ordered
initial- and final-state showers. The current description is not yet
finished; what is missing is an interleaving also with final-state 
shower evolution and, above all, a more successful scheme to handle
the correlated colour flow in the final state in events with 
complicated multiparton topologies.  

<h2>Main variables</h2>

The rate of interactions is determined by 
<parameter name="MultipleInteractions:alphaSvalue" default="0.127" 
min="0.06" max="0.25">
The value of <ei>alpha_strong</ei> at <ei>m_Z</ei>. Default value is 
picked equal to the one used in CTEQ 5L. 
</parameter> 

<p/>
The actual value is then regulated by the running to the scale 
<ei>pT^2</ei>, at which it is evaluated
<mode name="MultipleInteractions:alphaSorder" default="1" min="0" max="2">
The order at which <ei>alpha_strong</ei> runs at scales away from 
<ei>m_Z</ei>.
<option value="0">zeroth order, i.e. <ei>alpha_strong</ei> is kept 
fixed.</option>
<option value="1">first order, which is the normal value.</option>
<option value="2">second order. Since other parts of the code do 
not go to second order there is no strong reason to use this option, 
but there is also nothing wrong with it.</option>
</mode>

<p/>
Note that the choice of <ei>alpha_strong</ei> made here overrides the
one implemented in the normal process machinery, but only for the
interactions generated by the <ci>MultipleInteractions</ci> class.

<p/>
In addition there is the possibility of a global rescaling of 
cross sections (which could not easily be accommodated by a 
changed <ei>alpha_strong</ei>, since <ei>alpha_strong</ei> runs)
<parameter name="MultipleInteractions:Kfactor" default="1.0" min="0.5" 
max="4.0">
Multiply all cross sections by this fix factor.
</parameter>

<p/>
There are two complementary ways of regularizing the small-<ei>pT</ei> 
divergence, a sharp cutoff and a smooth dampening. These can be 
combined as desired, but it makes sense to coordinate with how the 
same issue is handled in spacelike showers. Actually, by default,
the parameters defined here are used also for the spacelike showers,
but this can be overridden.

<p/>
Regularization of the divergence of the QCD cross section for 
<ei>pT -> 0</ei> is obtained by a factor <ei>pT^4 / (pT0^2 + pT^2)^2</ei>, 
and by using an <ei>alpha_s(pT0^2 + pT^2)</ei>. An energy dependence 
of the <ei>pT0</ei> choice is introduced by two further parameters, 
so that <ei>pT0Ref</ei> is the <ei>pT0</ei> value for the reference 
cm energy, <ei>pT0Ref = pT0(ecmRef)</ei>.   
<note>Warning:</note> if a large <ei>pT0</ei> is picked for multiple 
interactions, such that the integrated interaction cross section is 
below the nondiffractive inelastic one, this <ei>pT0</ei> will 
automatically be scaled down to cope.

<p/>
The actual pT0 parameter used at a given cm energy scale, <ei>ecmNow</ei>,
is obtained as
<eq>
     pT0 = pT0(ecmNow) = pT0Ref * (ecmNow / ecmRef)^ecmPow 
</eq>
where <ei>pT0Ref</ei>, <ei>ecmRef</ei> and <ei>ecmPow</ei> are the 
three parameters below.

<parameter name="MultipleInteractions:pT0Ref" default="3.0" min="0.5" 
max="10.0">
The <ei>pT0Ref</ei> scale in the above formula.
<note>Note:</note> <ei>pT0Ref</ei> remains to be carefully tuned, but this 
has no point before the colour flow description has reached a more 
mature form.
</parameter>

<parameter name="MultipleInteractions:ecmRef" default="1800.0" min="1.">
The <ei>ecmRef</ei> reference energy scale introduced above.
</parameter>

<parameter name="MultipleInteractions:ecmPow" default="0.16" 
min="0.0" max="0.5">
The <ei>ecmPow</ei> energy rescaling pace introduced above.
</parameter>

<p/>
Alternatively, or in combination, a sharp cut can be used.
<parameter name="MultipleInteractions:pTmin" default="0.2" min="0.1" 
max="10.0">
Lower cutoff in <ei>pT</ei>, below which no further interactions 
are allowed. Normally <ei>pT0</ei> above would be used to provide 
the main regularization of the cross section for <ei>pT -> 0</ei>, 
in which case <ei>pTmin</ei> is used  mainly for technical reasons. 
It is possible, however, to set <ei>pT0Ref = 0</ei> and use 
<ei>pTmin</ei> to provide a step-function regularization, or to 
combine them in intermediate approaches. Currently <ei>pTmin</ei> 
is taken to be energy-independent.  
</parameter>

<p/> 
The choice of impact-parameter dependence is regulated by several
parameters.

<mode name="MultipleInteractions:bProfile" default="2" 
min="0" max="3">
Choice of impact parameter profile for the incoming hadron beams.
<option value="0">no impact parameter dependence at all.</option>
<option value="1">a simple Gaussian matter distribution; 
no free parameters.</option>
<option value="2">a double Gaussian matter distribution, 
with the two free parameters <ei>coreRadius</ei> and 
<ei>coreFraction</ei>.</option>
<option value="3">an overlap function, i.e. the convolution of 
the matter distributions of the two incoming hadrons, of the form
<ei>exp(- b^expPow)</ei>, where <ei>expPow</ei> is a free 
parameter.</option> 
</mode>

<parameter name="MultipleInteractions:coreRadius" default="0.4"
min="0.1" max="1.">
When assuming a double Gaussian matter profile, <ei>bProfile = 2</ei>,
the inner core is assumed to have a radius that is a factor
<ei>coreRadius</ei> smaller than the rest.
</parameter> 

<parameter name="MultipleInteractions:coreFraction" default="0.5" 
min="0." max="1."> 
When assuming a double Gaussian matter profile, <ei>bProfile = 2</ei>,
the inner core is assumed to have a fraction <ei>coreFraction</ei> 
of the matter content of the hadron.
</parameter> 

<parameter name="MultipleInteractions:expPow" default="1." 
min="0.4" max="10.">
When <ei>bProfile = 3</ei> it gives the power of the assumed overlap 
shape <ei>exp(- b^expPow)</ei>. Default corresponds to a simple 
exponential drop, which is not too dissimilar from the overlap 
obtained with the standard double Gaussian parameters. For 
<ei>expPow = 2</ei> we reduce to the simple Gaussian, <ei>bProfile = 1</ei>, 
and for <ei>expPow -> infinity</ei> to no impact parameter dependence 
at all, <ei>bProfile = 0</ei>. For small <ei>expPow</ei> the program 
becomes slow and unstable, so the min limit must be respected.
</parameter> 

<h2>Further variables</h2>

These should normally not be touched. Their only function is for
cross-checks.

<mode name="MultipleInteractions:nQuark" default="5" min="0" max="5">
Number of allowed incoming quark flavours in the beams; a change 
to 4 would thus exclude <ei>b</ei> and <ei>bbar</ei> as incoming 
partons, etc.
</mode>

<mode name="MultipleInteractions:nSample" default="1000" min="100"> 
The allowed <ei>pT</ei> range is split (unevenly) into 100 bins, 
and in each of these the interaction cross section is evaluated in 
<ei>nSample</ei> random phase space points. The full integral is used 
at initialization, and the differential one during the run as a
"Sudakov form factor" for the choice of the hardest interaction.
A larger number implies increased accuracy of the calculations.
</mode>

<h2>The process library</h2>

Currently the processes used to generate multiple interactions
are contained in a library separate from the standard set of
hard processes. This has come about for historical reasons and
may not be so forever, but has some advantages in terms of offering
a more streamlined generation for this particular application.
 
<p/>
Thus the <ci>SigmaProcess</ci> class contains the differential 
cross section <ei>d(sigma-hat)/d(t-hat)</ei> for a few different 
simple <ei>2 -> 2</ei> processes:
<ei>g g -> g g</ei>, 
<ei>q g -> q g</ei>, 
<ei>q_1 q_2 -> q_1 q_2</ei> (1 = 2 or not),
<ei>q_1 qbar_2 -> q_1 qbar_2</ei> (1 = 2 or not), 
<ei>q qbar -> q' qbar'</ei>,
<ei>g g -> q qbar</ei>, 
<ei>q g -> q gamma</ei>, 
<ei>q qbar -> g gamma</ei>, and 
<ei>q qbar -> gamma gamma</ei>.

<p/>
The code is structured so that several calls are expected to
prepare, calculate, and retrieve information inside the multiple
interactions framework.
<ol>

<li>Give in information on the scattering to be considered, either
<code>
    setupShTh( id1, id2, s-hat, t-hat) 
</code>
where the incoming two flavours and two Mandelstam variables 
are provided. Other kinematical variables and <ei>alpha_strong</ei> 
are then calculated. Alternatively
<code>
      setupShThAs( id1, id2, s-hat, t-hat, alpha_strong)
</code>
where also <ei>alpha_strong</ei> is provided. This actually is the 
case for multiple interactions applications. </li>

<li>Calculate and return <ei>d(sigma-hat)/d(t-hat)</ei>, using one 
of the methods named after the process it refers to. </li>

<li>In step 2, also some further choices are made, as required,
which can be read out afterwards, if desired<br/>
a) <ci>id3New()</ci> and <ci>id4New()</ci> return the flavours of 
the two outgoing partons; often the same as the incoming but not 
always.<br/>
b) <ci>colFlow()</ci> returns a single integer that packs the colour
flow topology selected, in the form
<eq>
      10^7 * c_1 + 10^6 * a_1 + 10^5 * c_2 + 10^4 * a_2 + 
      10^3 * c_3 + 10^2 * a_3 + 10 * c_4 + a_4
</eq>
where <ei>c_i</ei> and <ei>a_i</ei> is the colour and anticolour tag 
of parton <ei>i</ei>, using the Les Houches conventions starting with 
colour tag 1. (Such a solution does not scale well for higher 
multiplicities, but is time-efficient for <ei>2 -> 2</ei>.) 
Note that this code is for the nominal process, say <ei>q g -> q g</ei>,
so that sides need be swapped for <ei>g q -> g q</ei>, and colour tags 
with anticolour ones for <ei>qbar g -> qbar g</ei>, etc. </li>
   
<li>Better, however, is to let the routine do the <ei>2 -> 2</ei> 
kinematics in the rest frame. If the topology desired coincides with 
the one most recently calculated, one only needs
<code>
      doKinematics()
</code>
<code>
with no arguments, while otherwise 
      doKinematics( id1, id2, id3, id4, colourflow, s-hat, t-hat) 
</code></li>

<li>When kinematics has been set up, the partons can be retrieved
with 
<code>
      getParton(i)
</code>
<ei>0 &lt;= i &lt; 4</ei>, which returns a <ci>Particle</ci>. These 
can then be appended to the event record, with mothers and colour tags 
properly offset, and boosted to the proper frame of the subcollision. 
</li>

</ol>

<p/>
The size of QCD cross sections is mainly determined by 
<ei>alpha_strong</ei>, which is set at a scale of <ei>M_Z^2</ei> 
and then evaluated at <ei>pT^2</ei>:

<parameter name="SigmaProcess:alphaSvalue" default="0.1265" 
min="0.06" max="0.25">
The <ei>alpha_strong value</ei> at scale <ei>M_Z^2</ei>. 
<note>Note:</note> this is moot when <ci>setupShThAs</ci> is called, 
since then the externally provided <ci>alpha_strong</ci> is used. 
This is the case with multiple interactions, which provides its own 
<ci>alpha_strong</ci>.
</parameter>

<mode name="SigmaProcess:alphaSorder" default="1" min="0" max="2">
The order at which <ei>alpha_strong</ei> runs at scales away from 
<ei>m_Z</ei>.
<option value="0">zeroth order, i.e. <ei>alpha_strong</ei> is kept 
fixed.</option>
<option value="1">first order, which is the normal value.</option>
<option value="2">second order. Since other parts of the code do 
not go to second order there is no strong reason to use this option, 
but there is also nothing wrong with it.</option>
<note>Note:</note> this is moot when <ci>setupShThAs</ci> is called, 
since then the externally provided <ci>alpha_strong</ci> is used. 
This is the case with multiple interactions, which provides its own 
<ci>alpha_strong</ci>.
</mode>

<p/>
QED radiation is currently regulated by StandardModel:alphaEMfix.

<p/>
A final option is 

<mode name="SigmaProcess:nQuark" default="5" min="0" max="5">
Number of allowed quark flavours in <ei>q qbar -> q' qbar'</ei> and 
<ei>g g-> q qbar</ei> processes. A change to 4 would exclude 
<ei>b bbar</ei>, etc. 
</mode>

<h2>Technical notes</h2>

Relative to the articles mentioned above, not much has happened.
The main news is a technical one, that the phase space of the 
<ei>2 -> 2</ei> (massless) QCD processes is now sampled in 
<ei>dy_3 dy_4 dpT^2</ei>, where <ei>y_3</ei> and <ei>y_4</ei> are 
the rapidities of the two produced partons. One can show that
<eq>
    (dx_1 / x_1) * (dx_2 / x_2) * d(t-hat) = dy_3 * dy_4 * dpT^2
</eq>
Furthermore, since cross sections are dominated by the "Rutherford"
one of <ei>t</ei>-channel gluon exchange, which is enhanced by a 
factor of 9/4 for each incoming gluon, effective structure functions 
are defined as
<eq>
    F(x, pT2) = (9/4) * xg(x, pT2) + sum_i xq_i(x, pT2) 
</eq>
With this technical shift of factors 9/4 from cross sections to parton 
densities, a common upper estimate of 
<eq>
    d(sigma-hat)/d(pT2) &lt; pi * alpha_strong^2 / pT^4   
</eq>
is obtained. 

<p/>
In fact this estimate can be reduced by a factor of 1/2 for the 
following reason: for any configuration <ei>(y_3, y_4, pT2)</ei> also 
one with <ei>(y_4, y_3, pT2)</ei> lies in the phase space. Not both 
of those can enjoy being enhanced by the <ei>t-hat -> 0</ei> 
singularity of 
<eq>
    d(sigma-hat) propto 1/t-hat^2. 
</eq>
Or if they are, which is possible with identical partons like 
<ei>q q -> q q</ei> and <ei>g g -> g g</ei>, each singularity comes 
with half the strength. So, when integrating/averaging over the two 
configurations, the estimated <ei>d(sigma-hat)/d(pT2)</ei> drops. 
Actually, it drops even further, since the naive estimate above is 
based on
<eq>
    (4 /9) * (1 + (u-hat/s-hat)^2) &lt; 8/9 &lt; 1
</eq>
The 8/9 value would be approached for <ei>t-hat -> 0</ei>, which 
implies <ei>s-hat >> pT2</ei> and thus a heavy parton-distribution 
penalty, while parton distributions are largest for 
<ei>t-hat = u-hat = -s-hat/2</ei>, where the above expression 
evaluates to 5/9. A fudge factor is therefore introduced to go the 
final step, so it can easily be modifed when further non-Rutherford 
processes are added, or should parton distributions change significantly.

<p/>
At initialization, it is assumed that  
<eq>
    d(sigma)/d(pT2) &lt; d(sigma-hat)/d(pT2) * F(x_T, pT2) * F(x_T, pT2)
       * (2 y_max(pT))^2
</eq>
where the first factor is the upper estimate as above, the second two
the parton density sum evaluated at <ei>y_3 = y_ 4 = 0</ei> so that 
<ei>x_1 = x_2 = x_T = 2 pT / E_cm</ei>, where the product is expected 
to be maximal, and the final is the phase space for
<ei>-y_max &lt; y_{3,4} &lt; y_max</ei>.
The right-hand side expression is scanned logarithmically in <ei>y</ei>, 
and a <ei>N</ei> is determined such that it always is below 
<ei>N/pT^4</ei>.

<p/>
To describe the dampening of the cross section at <ei>pT -> 0</ei> by
colour screening, the actual cross section is multiplied by a 
regularization factor <ei>(pT^2 / (pT^2 + pT0^2))^2</ei>, and the 
<ei>alpha_s</ei> is evaluated at a scale <ei>pT^2 + pT0^2</ei>, 
where <ei>pT0</ei> is a free parameter of the order of 2 - 4 GeV. 
Since <ei>pT0</ei> can be energy-dependent,  an ansatz
<eq>
    pT0(ecm) = pT0Ref * (ecm/ecmRef)^ecmPow
</eq>
is used, where <ei>ecm</ei> is the current cm frame energy, 
<ei>ecmRef</ei> is an arbitrary reference energy where <ei>pT0Ref</ei> 
is defined, and <ei>ecmPow</ei> gives the energy rescaling pace. For 
technical reasons, also an absolute lower <ei>pT</ei> scale <ei>pTmin</ei>, 
by default 0.2 GeV, is introduced. In principle, it is possible to 
recover older scenarios with a sharp <ei>pT</ei> cutoff by setting 
<ei>pT0 = 0</ei> and letting <ei>pTmin</ei> be a larger number. 

<p/>
The above scanning strategy is then slightly modified: instead of
an upper estimate <ei>N/pT^4</ei> one of the form 
<ei>N/(pT^2 + r * pT0^2)^2</ei> is used. At first glance, <ei>r = 1</ei> 
would seem to be fixed by the form of the regularization procedure, 
but this does not take into account the nontrivial dependence on 
<ei>alpha_s</ei>, parton distributions and phase space. A better 
Monte Carlo efficiency is obtained for <ei>r</ei> somewhat below unity, 
and currently <ei>r = 0.25</ei> is hardcoded.

In the generation a trial <ei>pT2</ei> is then selected according to
<eq>
    d(Prob)/d(pT2) = (1/sigma_ND) * N/(pT^2 + r * pT0^2)^2 * ("Sudakov")
</eq>
For the trial <ei>pT2</ei>, a <ei>y_3</ei> and a <ei>y_4</ei> are then 
selected, and incoming flavours according to the respective 
<ei>F(x_i, pT2)</ei>, and then the cross section is evaluated for this 
flavour combination. The ratio of trial/upper estimate gives the 
probability of survival.

<p/>
Actually, to profit from the factor 1/2 mentioned above, the cross
section for the combination with <ei>y_3</ei> and <ei>y_4</ei> 
interchanged is also tried, which corresponds to exchanging <ei>t-hat</ei>
and <ei>u_hat</ei>, and the average formed, while the final kinematics 
is given by the relative importance of the two.

<p/>
Furthermore, since large <ei>y</ei> values are disfavoured by dropping 
PDF's, a factor 
<eq>
   WT_y = (1 - (y_3/y_max)^2) * (1 - (y_4/y_max)^2) 
</eq>
is evaluated, and used as a survival probability before the more
time-consuming PDF+ME evaluation, with surviving events given a 
compensating weight <ei>1/WT_y</ei>. 

<p/>
An impact-parameter dependencs is also allowed. Based on the hard 
<ei>pT</ei> scale of the first interaction, and enhancement/depletion 
factor is picked, which multiplies the rate of subsequent interactions.

<p/>
Parton densities are rescaled and modified to take into account the 
energy-momentum and flavours kicked out by already-considered 
interactions.

<h2>References</h2>

<ol>
<li>T. Sjostrand and M. van Zijl, Phys. Rev. D36 (1987) 2019</li>
<li>T. Sjostrand and P.Z. Skands, JHEP 03 (2004) 053</li>
<li>T. Sjostrand and P.Z. Skands, Eur. Phys. J. C39 (2005) 129</li> 
</ol>

</chapter>

<!-- Copyright C 2006 Torbjorn Sjostrand -->
